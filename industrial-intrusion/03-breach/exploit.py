#!/usr/bin/env python3

import sys
import time
from pymodbus.client import ModbusTcpClient as ModbusClient
from pymodbus.exceptions import ConnectionException

ip = sys.argv[1]
client = ModbusClient(ip, port=502)
client.connect()

def readAll():
    result = client.read_holding_registers(0, 30, unit=1)
    print(result.registers)

def writeAll():
    client.write_coil(address=20, value=0, unit=1)
    client.write_coil(address=25, value=0, unit=1)

# Read Once
print('[+] - Reading Coils ...')
readAll()

# Write All
print('[*] - Writing Coils ...')
writeAll()


# Read
print('[+] - Reading Coils Again ...')
readAll()